---
description: Backend structure and boundaries for Spring Boot app (feature-based).
globs: ["src/main/java/**"]
alwaysApply: false
---

# Backend Structure

- Package by feature: `com.bikerental.platform.rental.<feature>` (e.g., auth, bikes, rentals, overview, settings). Inside each feature: `controller/`, `service/`, `repo/`, `dto/`, `model/` (entities).
- Controllers: thin; map requests to DTOs; no business logic; never expose JPA entities.
- Services: contain business rules, transactions, validation of invariants (one RENTED per bike, OOO guard, status derivation). Keep methods small and cohesive.
- Repositories: Spring Data JPA interfaces; scoped queries by hotelId; no business logic.
- DTOs: request/response types; validate at boundaries; no domain mutations in DTOs.
- Entities: JPA mappings only; limited Lombok (`@Getter`, `@Setter`, `@NoArgsConstructor`, `@AllArgsConstructor`, `@RequiredArgsConstructor`); no `@Data` on entities; no Jackson annotations leaking from controllers.
- Transactions: service layer owns transactional boundaries for multi-step operations (rental creation, returns, mark lost).
- Cross-feature calls: prefer service interfaces; avoid circular dependencies; share only stable abstractions (e.g., time provider, security context).
- Validation: enforce invariants in services; reject client-sent hotel idsâ€”derive from security context/JWT.
- Config: keep secrets out of code; use `application.properties` / env; prefer constructor injection.
